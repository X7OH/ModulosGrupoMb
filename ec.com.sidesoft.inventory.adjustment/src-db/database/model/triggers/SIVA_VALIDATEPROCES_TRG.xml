<?xml version="1.0"?>
  <database name="TRIGGER SIVA_VALIDATEPROCES_TRG">
    <trigger name="SIVA_VALIDATEPROCES_TRG" table="SIVA_PHYSICAL_INVTLINES" fires="before" insert="true" update="true" delete="true" foreach="row">
      <body><![CDATA[
v_code_authorization VARCHAR2(60);           
BEGIN
 
  IF AD_isTriggerEnabled()='N' THEN RETURN;
  END IF;
   
  IF(DELETING or UPDATING or INSERTING)THEN
	IF(DELETING or UPDATING)THEN
		select coalesce((select code_authorization
			from siva_physical_inventory	
			where siva_physical_inventory_id = :old.siva_physical_inventory_id),'ND')
		into v_code_authorization
		from dual;
	ELSE
		select coalesce((select code_authorization
			from siva_physical_inventory	
			where siva_physical_inventory_id = :new.siva_physical_inventory_id),'ND')
		into v_code_authorization
		from dual;
	END IF;
		
	If(v_code_authorization != 'ND')Then
		RAISE_APPLICATION_ERROR(-20000, 'No se puede afectar esta transacción, el código ya fue generado');
	End If;
  End If;
 
  END SIVA_VALIDATEPROCES_TRG
]]></body>
    </trigger>
  </database>
