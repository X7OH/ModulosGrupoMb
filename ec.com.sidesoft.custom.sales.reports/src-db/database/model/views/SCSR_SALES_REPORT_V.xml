<?xml version="1.0"?>
  <database name="VIEW SCSR_SALES_REPORT_V">
    <view name="SCSR_SALES_REPORT_V"><![CDATA[SELECT to_date(to_char(a.dateinvoiced), 'dd/MM/yyyy') AS date, cd.name AS type_doc, substr(a.documentno, 1, instr(a.documentno, '-', 1) + 3) AS establishment, substr(a.documentno, instr(a.documentno, '-', 1) + 5, length(a.documentno)) AS sequence, a.documentno, b.taxid AS ruc, a.c_bpartner_id, COALESCE(sum(taxcero.taxbaseamt), 0) AS subtotal_cero, COALESCE(sum(taxiva.taxbaseamt), 0) AS subtotal_doce, COALESCE(sum(taxiva.taxamt), 0) AS iva_doce, COALESCE(sum(taxiva.taxbaseamt), 0) + COALESCE(sum(taxcero.taxbaseamt), 0) AS subtotal, COALESCE(sum(taxiva.taxamt), 0) + COALESCE(sum(taxiva.taxbaseamt), 0) + COALESCE(sum(taxcero.taxbaseamt), 0) AS total, far.documentno AS invoice_applied, far.name AS type_doc_applied, far.grandtotal AS total_sales, a.ad_org_id, a.c_invoice_id, a.c_invoice_id AS scsr_sales_report_v_id, a.ad_client_id, a.isactive, a.created, a.createdby, a.updated, a.updatedby FROM c_invoice a JOIN c_doctype cd ON cd.c_doctype_id = a.c_doctype_id JOIN c_bpartner b ON b.c_bpartner_id = a.c_bpartner_id JOIN ad_org org ON a.ad_org_id = org.ad_org_id LEFT JOIN (c_invoicetax taxiva JOIN c_tax ti ON taxiva.c_tax_id = ti.c_tax_id AND ti.rate <> 0 AND ti.istaxdeductable = 'Y') ON a.c_invoice_id = taxiva.c_invoice_id LEFT JOIN (c_invoicetax taxcero JOIN c_tax tc ON taxcero.c_tax_id = tc.c_tax_id AND tc.rate = 0 AND tc.istaxdeductable = 'Y') ON a.c_invoice_id = taxcero.c_invoice_id LEFT JOIN (SELECT ci.documentno, ci.grandtotal, cdoc.name, col.c_order_id FROM c_orderline col LEFT JOIN (m_inoutline mil JOIN m_inout mi ON mi.m_inout_id = mil.m_inout_id) ON mil.m_inoutline_id = col.m_inoutline_id LEFT JOIN (c_invoice ci JOIN c_doctype cdoc ON cdoc.c_doctype_id = ci.c_doctype_id) ON ci.c_order_id = mi.c_order_id WHERE col.m_inoutline_id IS NOT NULL GROUP BY ci.documentno, ci.grandtotal, cdoc.name, col.c_order_id) far ON far.c_order_id = a.c_order_id WHERE a.issotrx = 'Y' AND a.docstatus = 'CO' GROUP BY a.dateinvoiced, a.documentno, a.c_invoice_id, a.ad_client_id, a.isactive, a.created, a.createdby, a.updated, a.updatedby, b.taxid, b.name, far.documentno, cd.name, far.name, far.grandtotal, a.totallines, a.ad_org_id, org.value ORDER BY to_date(to_char(a.dateinvoiced), 'dd/MM/yyyy'), org.value, substr(a.documentno, 1, instr(a.documentno, '-', 1) + 3), substr(a.documentno, instr(a.documentno, '-', 1) + 5, length(a.documentno))]]></view>
  </database>
