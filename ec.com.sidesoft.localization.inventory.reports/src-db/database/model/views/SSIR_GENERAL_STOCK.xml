<?xml version="1.0"?>
  <database name="VIEW SSIR_GENERAL_STOCK">
    <view name="SSIR_GENERAL_STOCK"><![CDATA[SELECT a.name, get_uuid() AS ssir_general_stock_id, a.ad_client_id, a.ad_org_id, a.isactive, a.created, a.createdby, a.updated, a.updatedby, a.value, a.m_product_id, a.m_product_category_id, a.c_taxcategory_id, a.em_slps_product_category_id AS slps_product_category_id, a.em_slps_subcategory_prod_id AS slps_subcategory_prod_id, a.description, a.weight, a.upc, a.m_brand_id, a.c_bpartner_id, COALESCE(sum(n.movementqty), 0) AS stock, COALESCE((SELECT x.priceactual FROM c_orderline x LEFT JOIN c_order y ON y.c_order_id = x.c_order_id WHERE x.m_product_id = a.m_product_id AND y.issotrx = 'N' AND x.created = ((SELECT max(c_orderline.created) AS max FROM c_orderline LEFT JOIN c_order ON c_order.c_order_id = c_orderline.c_order_id WHERE c_orderline.m_product_id = a.m_product_id AND c_order.issotrx = 'N'))), 0) AS purchaseprice, j.pricelist AS salesprice, ssir_get_product_cost(a.m_product_id, to_date(now()), 'AVA') AS avgprice, p.m_warehouse_id, n.m_locator_id, q.c_uom_id FROM m_product a LEFT JOIN m_productprice j ON j.m_product_id = a.m_product_id LEFT JOIN m_pricelist_version k ON k.m_pricelist_version_id = j.m_pricelist_version_id LEFT JOIN m_pricelist l ON l.m_pricelist_id = k.m_pricelist_id LEFT JOIN m_transaction n ON n.m_product_id = a.m_product_id LEFT JOIN m_locator o ON o.m_locator_id = n.m_locator_id LEFT JOIN m_warehouse p ON p.m_warehouse_id = o.m_warehouse_id LEFT JOIN m_product_uom q ON q.m_product_id = a.m_product_id LEFT JOIN m_inoutline r ON r.m_inoutline_id = n.m_inoutline_id LEFT JOIN c_orderline s ON s.c_orderline_id = r.c_orderline_id WHERE l.isdefault = 'Y' AND l.issopricelist = 'Y' GROUP BY a.name, a.ad_client_id, a.ad_org_id, a.isactive, a.created, a.createdby, a.updated, a.updatedby, a.value, a.m_product_id, a.c_uom_id, a.m_product_category_id, a.c_taxcategory_id, a.description, a.weight, a.upc, a.m_brand_id, a.c_bpartner_id, j.pricelist, p.m_warehouse_id, n.m_locator_id, q.c_uom_id, a.em_slps_product_category_id, a.em_slps_subcategory_prod_id ORDER BY a.name]]></view>
  </database>
