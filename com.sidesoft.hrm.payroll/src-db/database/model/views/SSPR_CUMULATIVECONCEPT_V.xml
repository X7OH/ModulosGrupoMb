<?xml version="1.0"?>
  <database name="VIEW SSPR_CUMULATIVECONCEPT_V">
    <view name="SSPR_CUMULATIVECONCEPT_V"><![CDATA[SELECT c.isliquidation, a.ad_client_id, a.ad_org_id, a.createdby, a.updatedby, a.sspr_concept_id, b.c_bpartner_id, c.c_period_id, to_number(sum(a.amount)) AS amount, bb.periodno, bb.c_year_id, a.iscumulative, a.isprojected, d.conceptsubtype, a.isiess, COALESCE(to_number((SELECT sum(w.amount) AS sum FROM sspr_payroll_ticket_concept w LEFT JOIN sspr_payroll_ticket ba ON w.sspr_payroll_ticket_id = ba.sspr_payroll_ticket_id LEFT JOIN sspr_payroll ca ON ba.sspr_payroll_id = ca.sspr_payroll_id LEFT JOIN c_period x ON ca.c_period_id = x.c_period_id LEFT JOIN sspr_concept z ON w.sspr_concept_id = z.sspr_concept_id WHERE z.sspr_concept_id = (((SELECT sspr_process_payroll.sspr_conceptout_id FROM sspr_process_payroll WHERE (sspr_process_payroll.processname IN ('IT', 'IT_2022')) AND sspr_process_payroll.isactive = 'Y'))) AND w.iscumulative = 'Y' AND w.sspr_concept_id = a.sspr_concept_id AND ba.c_bpartner_id = b.c_bpartner_id AND x.periodno <= bb.periodno AND x.c_year_id = bb.c_year_id OR w.isincomecalculated = 'Y' AND w.iscumulative = 'Y' AND w.sspr_concept_id = a.sspr_concept_id AND ba.c_bpartner_id = b.c_bpartner_id AND x.periodno <= bb.periodno AND a.sspr_concept_id = z.sspr_concept_id AND x.c_year_id = bb.c_year_id)), 0) + COALESCE((SELECT sum(sspr_contract.previousincome) AS sum FROM c_bpartner LEFT JOIN sspr_contract ON sspr_contract.c_bpartner_id = c_bpartner.c_bpartner_id WHERE c_bpartner.c_bpartner_id = b.c_bpartner_id AND sspr_contract.sspr_concept_id = a.sspr_concept_id AND sspr_contract.c_year_id = bb.c_year_id), 0) + COALESCE((SELECT sum(COALESCE(CASE WHEN sl.totalnet < 0 THEN sl.totalnet * (-1) ELSE sl.totalnet END, 0)) AS sum FROM sspr_settlement sc LEFT JOIN sspr_settlementline sl ON sl.sspr_settlement_id = sc.sspr_settlement_id LEFT JOIN c_period scp ON sc.movementdate >= scp.startdate AND sc.movementdate <= scp.enddate WHERE sl.sspr_concept_id = (((SELECT sspr_process_payroll.sspr_conceptout_id FROM sspr_process_payroll WHERE (sspr_process_payroll.processname IN ('IT', 'IT_2022')) AND sspr_process_payroll.isactive = 'Y'))) AND sl.iscumulative = 'Y' AND sl.sspr_concept_id = a.sspr_concept_id AND sc.c_bpartner_id = b.c_bpartner_id AND scp.periodno <= bb.periodno AND scp.c_year_id = bb.c_year_id OR sl.isincomecalculated = 'Y' AND sl.iscumulative = 'Y' AND sl.sspr_concept_id = a.sspr_concept_id AND sc.c_bpartner_id = b.c_bpartner_id AND scp.periodno <= bb.periodno AND a.sspr_concept_id = sl.sspr_concept_id AND scp.c_year_id = bb.c_year_id AND sc.complete = 'Y'), 0) + COALESCE((SELECT sum(COALESCE(CASE WHEN sd.totalnet < 0 THEN sd.totalnet * (-1) ELSE sd.totalnet END, 0)) AS sum FROM sspr_settlement sc LEFT JOIN sspr_settlementdata sd ON sd.sspr_settlement_id = sc.sspr_settlement_id LEFT JOIN c_period scp ON sc.movementdate >= scp.startdate AND sc.movementdate <= scp.enddate WHERE sd.sspr_concept_id = (((SELECT sspr_process_payroll.sspr_conceptout_id FROM sspr_process_payroll WHERE (sspr_process_payroll.processname IN ('IT', 'IT_2022')) AND sspr_process_payroll.isactive = 'Y'))) AND sd.iscumulative = 'Y' AND sd.sspr_concept_id = a.sspr_concept_id AND sc.c_bpartner_id = b.c_bpartner_id AND scp.periodno <= bb.periodno AND scp.c_year_id = bb.c_year_id OR sd.isincomecalculated = 'Y' AND sd.iscumulative = 'Y' AND sd.sspr_concept_id = a.sspr_concept_id AND sc.c_bpartner_id = b.c_bpartner_id AND scp.periodno <= bb.periodno AND a.sspr_concept_id = sd.sspr_concept_id AND scp.c_year_id = bb.c_year_id AND sc.complete = 'Y'), 0) AS acumulative, COALESCE(to_number((((SELECT sum(w.amount) AS sum FROM sspr_payroll_ticket_concept w LEFT JOIN sspr_payroll_ticket ba ON w.sspr_payroll_ticket_id = ba.sspr_payroll_ticket_id LEFT JOIN sspr_payroll ca ON ba.sspr_payroll_id = ca.sspr_payroll_id LEFT JOIN c_period x ON ca.c_period_id = x.c_period_id LEFT JOIN sspr_concept z ON w.sspr_concept_id = z.sspr_concept_id WHERE w.isincomecalculated = 'Y' AND w.iscumulative = 'Y' AND w.isprojected = 'Y' AND w.sspr_concept_id = a.sspr_concept_id AND ba.c_bpartner_id = b.c_bpartner_id AND x.periodno <= bb.periodno AND a.sspr_concept_id = z.sspr_concept_id AND x.c_year_id = bb.c_year_id)) + COALESCE((SELECT sum(sspr_contract.previousincome) AS sum FROM c_bpartner LEFT JOIN sspr_contract ON sspr_contract.c_bpartner_id = c_bpartner.c_bpartner_id WHERE c_bpartner.c_bpartner_id = b.c_bpartner_id AND sspr_contract.sspr_concept_id = a.sspr_concept_id AND sspr_contract.c_year_id = bb.c_year_id), 0) + COALESCE((SELECT sum(COALESCE(CASE WHEN sl.totalnet < 0 THEN sl.totalnet * (-1) ELSE sl.totalnet END, 0)) AS sum FROM sspr_settlement sc LEFT JOIN sspr_settlementline sl ON sl.sspr_settlement_id = sc.sspr_settlement_id LEFT JOIN c_period scp ON sc.movementdate >= scp.startdate AND sc.movementdate <= scp.enddate WHERE sl.sspr_concept_id = (((SELECT sspr_process_payroll.sspr_conceptout_id FROM sspr_process_payroll WHERE (sspr_process_payroll.processname IN ('IT', 'IT_2022')) AND sspr_process_payroll.isactive = 'Y'))) AND sl.iscumulative = 'Y' AND sl.isprojected = 'Y' AND sl.sspr_concept_id = a.sspr_concept_id AND sc.c_bpartner_id = b.c_bpartner_id AND scp.periodno <= bb.periodno AND scp.c_year_id = bb.c_year_id OR sl.isincomecalculated = 'Y' AND sl.iscumulative = 'Y' AND sl.isprojected = 'Y' AND sl.sspr_concept_id = a.sspr_concept_id AND sc.c_bpartner_id = b.c_bpartner_id AND scp.periodno <= bb.periodno AND a.sspr_concept_id = sl.sspr_concept_id AND scp.c_year_id = bb.c_year_id AND sc.complete = 'Y'), 0) + COALESCE((SELECT sum(COALESCE(CASE WHEN sd.totalnet < 0 THEN sd.totalnet * (-1) ELSE sd.totalnet END, 0)) AS sum FROM sspr_settlement sc LEFT JOIN sspr_settlementdata sd ON sd.sspr_settlement_id = sc.sspr_settlement_id LEFT JOIN c_period scp ON sc.movementdate >= scp.startdate AND sc.movementdate <= scp.enddate WHERE sd.sspr_concept_id = (((SELECT sspr_process_payroll.sspr_conceptout_id FROM sspr_process_payroll WHERE (sspr_process_payroll.processname IN ('IT', 'IT_2022')) AND sspr_process_payroll.isactive = 'Y'))) AND sd.iscumulative = 'Y' AND sd.isprojected = 'Y' AND sd.sspr_concept_id = a.sspr_concept_id AND sc.c_bpartner_id = b.c_bpartner_id AND scp.periodno <= bb.periodno AND scp.c_year_id = bb.c_year_id OR sd.isincomecalculated = 'Y' AND sd.iscumulative = 'Y' AND sd.isprojected = 'Y' AND sd.sspr_concept_id = a.sspr_concept_id AND sc.c_bpartner_id = b.c_bpartner_id AND scp.periodno <= bb.periodno AND a.sspr_concept_id = sd.sspr_concept_id AND scp.c_year_id = bb.c_year_id AND sc.complete = 'Y'), 0)) / bb.periodno * (12 - bb.periodno)), 0) AS amountprojected FROM sspr_payroll_ticket_concept a LEFT JOIN sspr_payroll_ticket b ON a.sspr_payroll_ticket_id = b.sspr_payroll_ticket_id LEFT JOIN sspr_payroll c ON b.sspr_payroll_id = c.sspr_payroll_id LEFT JOIN c_period bb ON c.c_period_id = bb.c_period_id LEFT JOIN sspr_concept d ON a.sspr_concept_id = d.sspr_concept_id WHERE (a.isincomecalculated = 'Y' OR d.sspr_concept_id = (((SELECT sspr_process_payroll.sspr_conceptout_id FROM sspr_process_payroll WHERE (sspr_process_payroll.processname IN ('IT', 'IT_2022')) AND sspr_process_payroll.isactive = 'Y')))) AND c.ispayroll = 'Y' AND c.isliquidation = 'N' GROUP BY c.isliquidation, a.sspr_concept_id, b.c_bpartner_id, c.c_period_id, bb.periodno, bb.c_year_id, a.ad_client_id, a.ad_org_id, a.createdby, a.updatedby, a.iscumulative, a.isprojected, d.conceptsubtype, a.isiess ORDER BY c.isliquidation, a.ad_client_id, a.ad_org_id, a.updatedby, a.sspr_concept_id]]></view>
  </database>
