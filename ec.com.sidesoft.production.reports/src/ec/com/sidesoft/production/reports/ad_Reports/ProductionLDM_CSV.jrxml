<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Rpt_ProductionLDM" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<parameter name="AD_Org_ID" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="DateFrom" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="DateTo" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="C_DocType_ID" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="M_Product_Category_ID" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="M_Product_ID" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<parameter name="AD_User_ID" class="java.lang.String">
		<defaultValueExpression><![CDATA[]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[select a.m_production_id,
b.m_productionplan_id,
b.m_product_id,
a.documentno,
a.ad_org_id,
k.name as orgname,
a.MovementDate,
c.name as tipodoc,
j.name as categoria,
d.value as cod_producto,
d.name as producto,
b.productionqty as cantidad,
coalesce(f.name,e.name) as unidad,
sum(i.cost) as costototal,
sum(i.cost)/b.productionqty as costounitario ,
to_char('ND') as puntoventa,
to_char('Usuario: ') || (select coalesce(to_char(cbp.name), to_char(au.name)) from ad_user au left join c_bpartner cbp on cbp.c_bpartner_id = au.c_bpartner_id where au.ad_user_id = $P{AD_User_ID}) AS "usuario",
'Fecha de Impresión:  ' || TO_CHAR(NOW(),'dd/MM/yyyy HH24:MI:SS') as fecha_impresion
from m_production a
left join m_productionplan b on a.m_production_id = b.m_production_id
left join c_doctype c on a.em_spdai_c_doctype_id = c.c_doctype_id
left join m_product d on b.m_product_id = d.m_product_id
left join c_uom e on d.c_uom_id = e.c_uom_id
left join c_uom_trl f on e.c_uom_id = f.c_uom_id
left join m_productionline g on b.m_productionplan_id = g.m_productionplan_id and g.movementqty = b.productionqty
left join m_transaction h on g.m_productionline_id = h.m_productionline_id and h.movementqty = b.productionqty
left join m_transaction_cost i on h.m_transaction_id = i.m_transaction_id
left join M_product_category j on d.M_product_category_id = j.M_product_category_id
LEFT JOIN AD_ORG k on a.ad_org_id = k.ad_org_id
where a.ad_org_id = $P{AD_Org_ID}
and (a.MovementDate between $P{DateFrom} and $P{DateTo})
and ( a.em_spdai_c_doctype_id = $P{C_DocType_ID} or $P{C_DocType_ID} is null)
and ( d.M_product_category_id = $P{M_Product_Category_ID} or $P{M_Product_Category_ID} is null)
and ( b.m_product_id = $P{M_Product_ID} or $P{M_Product_ID} is null)
group by a.m_production_id,b.m_productionplan_id,b.m_product_id,a.documentno,d.value,d.name,b.productionqty,coalesce(f.name,e.name) ,c.name,j.name    ,k.name
order by 9,11]]>
	</queryString>
	<field name="m_production_id" class="java.lang.String"/>
	<field name="m_productionplan_id" class="java.lang.String"/>
	<field name="m_product_id" class="java.lang.String"/>
	<field name="documentno" class="java.lang.String"/>
	<field name="ad_org_id" class="java.lang.String"/>
	<field name="orgname" class="java.lang.String"/>
	<field name="movementdate" class="java.sql.Timestamp"/>
	<field name="tipodoc" class="java.lang.String"/>
	<field name="categoria" class="java.lang.String"/>
	<field name="cod_producto" class="java.lang.String"/>
	<field name="producto" class="java.lang.String"/>
	<field name="cantidad" class="java.math.BigDecimal"/>
	<field name="unidad" class="java.lang.String"/>
	<field name="costototal" class="java.math.BigDecimal"/>
	<field name="costounitario" class="java.math.BigDecimal"/>
	<field name="puntoventa" class="java.lang.String"/>
	<field name="usuario" class="java.lang.String"/>
	<field name="fecha_impresion" class="java.lang.String"/>
	<title>
		<band height="49" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="800" height="20"/>
				<textElement textAlignment="Center">
					<font isBold="true"/>
				</textElement>
				<text><![CDATA[PRODUCCIÓN LDM ]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="37" width="100" height="12"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[PUNTO DE VENTA]]></text>
			</staticText>
			<staticText>
				<reportElement x="245" y="23" width="66" height="12"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA HASTA:]]></text>
			</staticText>
			<staticText>
				<reportElement x="0" y="23" width="100" height="12"/>
				<textElement textAlignment="Center">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[FECHA DESDE:]]></text>
			</staticText>
			<textField>
				<reportElement x="100" y="23" width="145" height="12"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{DateFrom}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="311" y="23" width="178" height="12"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$P{DateTo}]]></textFieldExpression>
			</textField>
			<staticText>
				<reportElement x="721" y="37" width="79" height="12"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[COSTO  TOTAL]]></text>
			</staticText>
			<staticText>
				<reportElement x="559" y="37" width="82" height="12"/>
				<textElement textAlignment="Center">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[UNIDAD]]></text>
			</staticText>
			<staticText>
				<reportElement x="490" y="37" width="69" height="12"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CANTIDAD ELAB.]]></text>
			</staticText>
			<staticText>
				<reportElement x="311" y="37" width="178" height="12"/>
				<textElement>
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[NOMBRE PRODUCTO]]></text>
			</staticText>
			<staticText>
				<reportElement x="245" y="37" width="66" height="12"/>
				<textElement textAlignment="Center">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CODIGO]]></text>
			</staticText>
			<staticText>
				<reportElement x="641" y="37" width="79" height="12"/>
				<textElement textAlignment="Right">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[COSTO UNITARIO]]></text>
			</staticText>
			<staticText>
				<reportElement x="100" y="37" width="145" height="12"/>
				<textElement textAlignment="Center">
					<font size="8" isBold="true"/>
				</textElement>
				<text><![CDATA[CATEGORIA]]></text>
			</staticText>
		</band>
	</title>
	<pageHeader>
		<band splitType="Stretch"/>
	</pageHeader>
	<columnHeader>
		<band splitType="Stretch"/>
	</columnHeader>
	<detail>
		<band height="14" splitType="Stretch">
			<textField pattern="###0.00;-###0.00" isBlankWhenNull="true">
				<reportElement x="641" y="0" width="79" height="14"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{costounitario}]]></textFieldExpression>
			</textField>
			<textField pattern="###0.00;-###0.00" isBlankWhenNull="true">
				<reportElement x="721" y="0" width="79" height="14"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{costototal}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="559" y="0" width="82" height="14"/>
				<textElement textAlignment="Center">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{unidad}]]></textFieldExpression>
			</textField>
			<textField pattern="###0.00;-###0.00" isBlankWhenNull="true">
				<reportElement x="490" y="0" width="69" height="14"/>
				<textElement textAlignment="Right">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.math.BigDecimal"><![CDATA[$F{cantidad}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="311" y="0" width="178" height="14"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{producto}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="245" y="0" width="66" height="14"/>
				<textElement textAlignment="Center">
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{cod_producto}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="100" y="0" width="145" height="14"/>
				<textElement>
					<font size="8" isBold="false"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{categoria}]]></textFieldExpression>
			</textField>
			<textField>
				<reportElement x="0" y="0" width="100" height="14"/>
				<textElement>
					<font size="8"/>
				</textElement>
				<textFieldExpression class="java.lang.String"><![CDATA[$F{orgname}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
